<div class="card border-0 shadow-sm">
  <!-- Header -->
  <div class="card-body pb-2">
    <nav class="small text-muted mb-2">
      <a href="/">Home</a> /
      <a href="/prefecture/{{post.where.prefecture}}">{{post.where.prefecture}}</a> /
      <a href="/city/{{post.where.prefecture}}/{{post.where.city}}">{{post.where.city}}</a>
    </nav>

    <h1 class="h2 mb-3">{{post.title}}</h1>

    <div class="d-flex flex-wrap align-items-center text-muted small">
      <span>by <a href="/user/profile/{{author._id}}">{{author.name}}</a></span>
      <span class="mx-2">•</span>
      <span><i class="fa fa-clock-o"></i> {{timeago post.timestamp}}</span>
      <span class="mx-2">•</span>
      <span><i class="fa fa-map-marker"></i> {{post.where.city}}, {{post.where.prefecture}}</span>
    </div>
  </div>

  <!-- Content: text (8) + compact carousel (4) -->
  <div class="px-3 pb-3">
    <div class="row">
      <!-- Text -->
      <div class="col-md-8">
        <article class="post-body">
          <p class="mb-0">{{post.description}}</p>
        </article>

        <!-- Actions / stats — modern look + old JS hooks -->
        <div class="d-flex flex-wrap align-items-center mt-3">
          {{#if user}}
            <button class="btn btn-light btn-chip mr-2" id="btn-like" data-id="{{post._id}}" type="button">
              {{!-- modern heart icon, but JS only cares about the count --}}
              {{#if user_liked}}<i class="fa fa-heart text-danger"></i>{{else}}<i class="fa fa-heart-o"></i>{{/if}}
              <span class="ml-1 likes-count">{{post.likes.length}}</span>
            </button>

            <button class="btn btn-light btn-chip mr-3" id="btn-save" data-id="{{post._id}}" type="button">
              {{#if user_saved}}<i class="fa fa-flag text-warning"></i>{{else}}<i class="fa fa-flag-o"></i>{{/if}}
              <span class="ml-1 saves-count">{{post.saved_by.length}}</span>
            </button>
          {{else}}
            <a class="btn btn-light btn-chip mr-2" href="/user/login">
              <i class="fa fa-heart-o"></i> <span class="ml-1">{{post.likes.length}}</span>
            </a>
            <a class="btn btn-light btn-chip mr-3" href="/user/login">
              <i class="fa fa-flag-o"></i> <span class="ml-1">{{post.saved_by.length}}</span>
            </a>
          {{/if}}

          <span class="text-muted small mr-3"><i class="fa fa-eye"></i> {{post.views}}</span>

          {{!-- invisible anchors that scripts.js reloads --}}
          <div id="likes" class="d-none"><span class="likes-count">{{post.likes.length}}</span></div>
          <div id="saves" class="d-none"><span class="saves-count">{{post.saved_by.length}}</span></div>
        </div>
      </div>

      <!-- Compact carousel (always on the right) -->
      <aside class="col-md-4 mt-3 mt-md-0">
        {{#if post.filenames}}
          <div id="postCarousel-{{post._id}}" class="carousel slide post-carousel mb-2" data-ride="carousel">
            {{#if post.filenames.[1]}}
            <ol class="carousel-indicators">
              {{#each post.filenames}}
                <li data-target="#postCarousel-{{@../post._id}}" data-slide-to="{{@index}}" class="{{#if @first}}active{{/if}}"></li>
              {{/each}}
            </ol>
            {{/if}}

            <div class="carousel-inner">
              {{#each post.filenames}}
              <div class="carousel-item {{#if @first}}active{{/if}}">
                {{#ifExtensionEquals this "mp4"}}
                  <video class="post-media-compact" controls preload="metadata">
                    <source src="/public/upload/{{../post._id}}/{{this}}" type="video/mp4" />
                  </video>
                {{else}}
                  <img src="/public/upload/{{../post._id}}/{{this}}" class="post-media-compact" alt="{{../post.title}}">
                {{/ifExtensionEquals}}
              </div>
              {{/each}}
            </div>

            {{#if post.filenames.[1]}}
            <a class="carousel-control-prev" href="#postCarousel-{{post._id}}" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#postCarousel-{{post._id}}" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
            {{/if}}
          </div>
        {{else}}
          <figure class="post-aside shadow-sm rounded d-flex align-items-center justify-content-center">
            <img src="/public/img/share-japan_logo.png" alt="Share Japan" style="width: 40%;">
          </figure>
        {{/if}}
      </aside>
    </div>
  </div>
</div>
